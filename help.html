<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>帮助 — OI 教练模拟器</title>
<link rel="stylesheet" href="styles.css">
<style>
  .doc{max-width:900px;margin:24px auto;padding:18px;background:#fff;border-radius:8px}
  .doc h2{margin-top:14px}
  .muted{color:#666}
  .example{background:#f7f9fc;padding:10px;border-radius:6px;border:1px solid #eef4fb}
  ul.guide{padding-left:18px}
  .pill{display:inline-block;padding:4px 8px;margin:6px 6px 6px 0;border-radius:999px;background:#eef6ff;color:#1b4f8a}
</style>
<script type="text/javascript">
  (function(c,l,a,r,i,t,y){
    c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
    t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
    y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
  })(window, document, "clarity", "script", "tpe6xsi392");
</script>
</head>
<body>
<div class="container">
  <div class="doc">
    <h1>玩法说明（基于当前版本）</h1>

    <h2>核心概念</h2>
    <ul class="guide">
      <li><strong>周制赛季</strong>：游戏按周推进。赛季会在固定周次触发预设的比赛（例如 CSP-S1 / CSP-S2 / NOIP / 省选 / NOI）。你需要在比赛前的若干周安排训练、模拟赛或集训来备战。</li>
      <li><strong>经费与声誉</strong>：经费用于设施升级、购买付费模拟赛和集训；声誉会影响某些事件与外部支援的概率（如赞助或优质生源）。</li>
      <li><strong>学生（Student）</strong>：每位学生包含多项数值属性（thinking、coding、mental、各类知识点等）、状态（生病、退队、疲劳）和天赋（talents）。这些数值决定训练效率与比赛表现。</li>
    </ul>

    <h2>学生属性速览</h2>
    <ul class="guide">
      <li><strong>思维 (Thinking) / 编程 (Coding)</strong>：基础能力值，用于构成综合能力；训练与某些天赋会提升它们。</li>
      <li><strong>知识（Knowledge）</strong>：按专题分为 data structures、graph、string、math、DP 等（页面中显示为中文类别）。题库（TASK_POOL）中的题目会给出对应的知识点增益。</li>
      <li><strong>心理素质 (Mental)</strong>：影响比赛稳定性（mental 在比赛时会被拷贝为 per-contest constmental，用于减少成绩波动）。</li>
      <li><strong>压力 (Pressure) 与 舒适度 (Comfort)</strong>：压力过高会降低训练效率并增加退队/生病概率；舒适度受设施（宿舍/空调/食堂）和天气影响。</li>
      <li><strong>状态</strong>：学生可能出现短期生病（sick_weeks）、燃尽（burnout）或退队（active=false）。合理安排休息与娱乐可以降低风险。</li>
    </ul>

    <h2>训练与题库</h2>
    <ul class="guide">
      <li>训练按周执行，选择不同强度（轻度/中度/高强度）会影响知识/能力增长与压力变化。</li>
      <li>题库（TASK_POOL）包含大量真实/经典题目，它们带有 difficulty（0-100）和 boosts（哪些知识点会增长以及增长量）。</li>
      <li>选择题目时系统会根据学生的平均能力匹配题目（selectRandomTasks / recommendTasksForStudent），并用二次函数或 multiplier 计算实际知识点增益。</li>
      <li>训练与做题的效率受设施影响：机房提升 coding 类训练效率，资料库提升知识类训练效率，食堂/宿舍/空调影响压力与舒适度，从而间接影响学习效率。</li>
    </ul>

    <h2>模拟赛（练习）与正式比赛</h2>
    <ul class="guide">
      <li>模拟赛可选择免费或付费题库，付费题库通常回报更稳定（被实现为更高质量的题目与更好的评估反馈）。</li>
      <li>比赛模拟采用分时（tick）系统：每个 tick 代表若干分钟，学生会在每个 tick 中选择题目、思考、尝试通过子任务（subtask），并实时记录日志。</li>
      <li>题目由若干子任务组成（3-5 段），每段有自己的分值与难度。学生通过概率与能力/知识值比较来尝试通过子任务并获得得分。</li>
      <li>正式比赛会把学生当前的综合能力（由 thinking/coding/mental 和知识加权计算）与题目难度比较，使用 sigmoid/噪声模型决定得分，mental 会影响稳定性（波动范围）。</li>
    </ul>

    <h2>天赋系统（Talents）</h2>
    <ul class="guide">
      <li>天赋由 `TalentManager` 管理并按概率分配给学生（每个天赋有 prob 字段）。天赋会在特定事件（contest_start / contest_select_problem / contest_thinking / contest_pass_subtask / contest_solve_problem 等）触发自定义效果。</li>
      <li>示例天赋包括：冷静（临时提升能力）、爆发型（短时间内大幅提升能力）、心态稳定（连续 AC 后提升 mental）、Ad-hoc 大师（极低概率直接通过子任务）等。</li>
      <li>天赋可临时修改学生属性（并在赛后通过内部 cleanup 恢复），天赋触发会生成日志并显示在比赛/事件面板。</li>
    </ul>

    <h2>事件系统</h2>
    <ul class="guide">
      <li>事件在周结算或运行时产生（pushEvent），包括自动事件与选择型事件（带 options）。事件会记录日志并显示在事件卡片区。</li>
      <li>事件触发概率依赖当前游戏状态（声誉、设施等级、舒适度、周数等），示例：赞助、机房故障、机房维修、团队矛盾、金牌教练来访等。</li>
    </ul>

    <h2>设施与预算</h2>
    <ul class="guide">
      <li>主要设施：机房(Computer)、资料库(Library)、空调(AC)、宿舍(Dorm)、食堂(Canteen)。设施等级决定训练/舒适/生病概率等系数。</li>
      <li>升级设施需一次性支出并增加每周维护费用（GameState.getWeeklyCost / getMaintenanceCost）。预算不足会限制购置/集训等高费用活动。</li>
    </ul>

    <h2>界面与操作提示</h2>
    <ul class="guide">
      <li><strong>顶部信息栏</strong>：显示当前周数、所在省份、经费、声誉与天气摘要。</li>
      <li><strong>学生卡</strong>：展示每位学生的基础属性、知识点、压力与状态（生病/退队），并支持对单人安排训练或移除。</li>
      <li><strong>本周行动面板</strong>：用于选择本周的训练/模拟赛/外出集训/娱乐等操作，操作在周结算时生效。</li>
      <li><strong>事件卡片区</strong>：显示近期发生的事件（pushEvent），选择型事件会在卡片上显示选项按钮。</li>
      <li><strong>比赛面板</strong>：在比赛周点击比赛将进入 ContestSimulator 的实时模拟视图，你可以查看每个 tick 的日志和选手得分。</li>
    </ul>

    <h2>常见问题（FAQ）</h2>
    <ul class="guide">
      <li><strong>Q:</strong> 为什么学生在比赛中表现波动很大？<br><strong>A:</strong> 除了基础能力，mental（赛中稳定性）会影响随机波动，天赋与临时增益也会改变短期表现。</li>
      <li><strong>Q:</strong> 模拟赛结果如何转化为知识增长？<br><strong>A:</strong> 模拟赛结束后系统会把每位学生在题目上获得的“子任务得分/命中情况”转化为知识点增长与心理/压力变化（实现见 applyTaskBoosts / calculateBoostMultiplier）。</li>
      <li><strong>Q:</strong> 天赋如何生效与查看？<br><strong>A:</strong> 天赋在比赛相关事件触发时运行；Help 中未列出的天赋可以在代码文件 `lib/talent.js` 中查看或在游戏 UI 的天赋面板里查看描述（UI 会使用 TalentManager.getTalentInfo 展示）。</li>
      <li><strong>Q:</strong> 如何避免学生生病或退队？<br><strong>A:</strong> 提升宿舍与空调等级、适量安排娱乐/休息、避免长期高强度训练可以降低生病与退队风险。</li>
    </ul>

    <div class="modal-actions" style="margin-top:18px">
      <a class="btn" href="game.html">回到游戏</a>
    </div>

  </div>
</div>
  <footer style="text-align:center;padding:12px 8px;color:#666;font-size:13px;border-top:1px solid #eee;margin-top:18px">
    作者 @Dreamers-seve · 洛谷: <a href="https://www.luogu.com.cn/user/668972" target="_blank" rel="noopener">https://www.luogu.com.cn/user/668972</a> · GitHub: <a href="https://github.com/Dreamersseve/OItrainer" target="_blank" rel="noopener">https://github.com/Dreamersseve/OItrainer</a>
  </footer>
</body>
</html>